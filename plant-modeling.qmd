---
title: "plant-modeling"
format: html
editor: visual
output:
    html_document:
      print_df: paged
      toc: yes
      toc_depth: 4
      toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(tidyverse)
library(sjPlot)
library(generics)
```

# Project Overview

# Data

```{r}
source(file.path("data_fetch.R"))
```

## Data Preperation

Data was prepared in the `data_fetch.R` script. 

## Data Exploration

```{r}
ggplot(join, aes(x = avg_photo)) +
  geom_histogram() +
  theme_linedraw() +
  labs(x = "Avg. Photosynthetic Rate per Leaf Area (Âµmol.m-2.s-1)")
```


```{r}
ggplot(data = join, aes(x = avg_photo, y = pop_trend)) + 
  geom_jitter(width = 0, height = 0.05, alpha = 0.8) +
  theme_linedraw() +
  labs(x = "Avg. Photosynthetic Rate per Leaf Area (Âµmol.m-2.s-1)", 
       y = "Population Trend")
```


# Logistic Regression

##### **Length** $$\operatorname{logit}(p)=\log \left(\frac{p}{1-p}\right)=\beta_0+\beta_1  (Photosynthetic Rate)  +\varepsilon $$

```{r}
ggplot(join, aes(x = avg_photo, y = pop_trend_binary)) + 
  geom_jitter(width = 0, height = 0.05, alpha = 0.8) +
  #geom_smooth(method = "lm", se = FALSE, color = "blue") +
  geom_smooth(method = "glm", se = FALSE, color = "red", 
              method.args = list(family = "binomial")) +
  theme_linedraw()
```


```{r}
# Log regression length
mod_photo <- glm(pop_trend_binary ~ avg_photo, 
                  data = join, 
                  family = "binomial")
# Model output table format
sjPlot::tab_model(mod_photo,
          transform = NULL,
          pred.labels = c("Intercept", "Photosynthetic Rate ()"),
          dv.labels = c("log Trend Pobability"),
          show.p = TRUE,
          p.style = c("numeric_stars"),
          p.threshold = c(0.10, 0.05, 0.01),
          string.p = "P-value",
          show.r2 = FALSE,
          title = "Logisitc Regression Model Results for Photosynthetic Rate",
          digits = 3)
```

```{r}
# compute fitted prob.
photo_plus <- mod_photo %>%
  augment(type.predict = "response") %>%
  mutate(y_hat = .fitted)
# compute odds
photo_plus <- photo_plus %>% 
  mutate(odds_hat = y_hat / (1 - y_hat)) 

# plot
ggplot(photo_plus, aes(x = avg_photo, y = odds_hat)) +
  geom_point(size = 1) + 
  geom_line() + 
  scale_y_continuous("Odds of being threatened") +
  labs(x = "Species Photosynthetic Rate ()", 
       title = "Odds of being threatened by species photosynthetic rate") +
  theme_linedraw()
```

## 

# Thoughts and Conclusions

```{r}
ggplot(data = join, aes(x = avg_photo, y = pop_trend_binary)) + 
  geom_jitter(width = 0, height = 0.05, alpha = 0.8) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Avg. Photosynthetic Rate per Leaf Area (Âµmol.m-2.s-1)", 
       y = "Decreasing or Stable/Increasing Populaiton Trend") +
  theme_linedraw()
```

```{r}
mod_photo <- glm(pop_trend_binary~avg_photo, data = join, family = 'binomial') # binomial dist; prob of 1 and 0 over many trials
summary(mod_photo)
```


```{r}
toSolve <- function(p) {
  (1-p)*exp(1.56-0.05847*64) - p
  }

uniroot(toSolve, interval = c(0, 1))$root
```



```{r}

```

